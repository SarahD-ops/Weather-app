<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter font for a modern look */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Custom styles for animations and loading states */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3B82F6; /* Tailwind blue-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-400 to-purple-600 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md backdrop-filter backdrop-blur-lg bg-opacity-80 border border-gray-200">
        <h1 class="text-3xl font-extrabold text-center mb-6 text-gray-800">Weather Forecast ☀️</h1>

        <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <input
                type="text"
                id="cityInput"
                placeholder="Enter city name..."
                class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 shadow-sm"
            >
            <button
                id="getWeatherBtn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center"
            >
                Get Weather
            </button>
        </div>

        <div id="weatherDisplay" class="hidden">
            <div class="flex items-center justify-center mb-4">
                <div id="loadingIndicator" class="loading-spinner hidden"></div>
            </div>
            <p id="errorMessage" class="text-red-600 text-center mb-4"></p>

            <div id="weatherContent" class="text-center">
                <h2 class="text-4xl font-bold text-gray-900 mb-2" id="locationName"></h2>
                <div class="flex items-center justify-center mb-4">
                    <img id="weatherIcon" src="" alt="Weather Icon" class="w-20 h-20">
                    <p class="text-6xl font-extrabold text-gray-900 ml-4" id="temperature"></p>
                    <span class="text-4xl text-gray-600 font-semibold align-top mt-[-10px]">&deg;C</span>
                </div>
                <p class="text-2xl text-gray-700 font-medium mb-4" id="condition"></p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-left">
                    <div class="bg-blue-50 p-4 rounded-lg shadow-sm">
                        <p class="text-lg font-semibold text-gray-700">Humidity:</p>
                        <p class="text-xl text-blue-800" id="humidity"></p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg shadow-sm">
                        <p class="text-lg font-semibold text-gray-700">Wind Speed:</p>
                        <p class="text-xl text-blue-800" id="windSpeed"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const cityInput = document.getElementById('cityInput');
        const getWeatherBtn = document.getElementById('getWeatherBtn');
        const weatherDisplay = document.getElementById('weatherDisplay');
        const locationName = document.getElementById('locationName');
        const temperature = document.getElementById('temperature');
        const condition = document.getElementById('condition');
        const humidity = document.getElementById('humidity');
        const windSpeed = document.getElementById('windSpeed');
        const weatherIcon = document.getElementById('weatherIcon');
        const errorMessage = document.getElementById('errorMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const weatherContent = document.getElementById('weatherContent');

        // Your provided API key
        const API_KEY = '112341199b074b6d98f134505251208'; // Replace with your actual API key

        /**
         * Fetches weather data for a given city from WeatherAPI.com.
         * Implements exponential backoff for API calls.
         * @param {string} city - The name of the city.
         * @param {number} retries - Number of retries attempts (default 3).
         * @param {number} delay - Initial delay in milliseconds (default 1000ms).
         * @returns {Promise<object|null>} - Weather data or null if error.
         */
        async function fetchWeatherData(city, retries = 3, delay = 1000) {
            const url = `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${city}`;

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorData = await response.json();
                        // If it's a 400 error (bad request, often invalid city), don't retry
                        if (response.status === 400) {
                            throw new Error(errorData.error.message || 'City not found.');
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed: ${error.message}`);
                    if (i < retries - 1) {
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                    } else {
                        throw error; // Re-throw error after all retries fail
                    }
                }
            }
            return null; // Should not be reached
        }

        /**
         * Displays the fetched weather data on the page.
         * @param {object} data - The weather data object.
         */
        function displayWeather(data) {
            locationName.textContent = `${data.location.name}, ${data.location.country}`;
            temperature.textContent = `${Math.round(data.current.temp_c)}`;
            condition.textContent = data.current.condition.text;
            humidity.textContent = `${data.current.humidity}%`;
            windSpeed.textContent = `${data.current.wind_kph} km/h`;
            weatherIcon.src = data.current.condition.icon;
            weatherIcon.alt = data.current.condition.text;

            weatherContent.classList.remove('hidden'); // Show content
            errorMessage.textContent = ''; // Clear any previous errors
            weatherDisplay.classList.remove('hidden');
        }

        /**
         * Hides weather content and shows an error message.
         * @param {string} message - The error message to display.
         */
        function showError(message) {
            weatherContent.classList.add('hidden'); // Hide content
            errorMessage.textContent = message;
            weatherDisplay.classList.remove('hidden'); // Keep display container visible for error
        }

        /**
         * Handles the click event for the "Get Weather" button.
         */
        getWeatherBtn.addEventListener('click', async () => {
            const city = cityInput.value.trim();
            if (!city) {
                showError('Please enter a city name.');
                return;
            }

            // Show loading indicator
            loadingIndicator.classList.remove('hidden');
            weatherContent.classList.add('hidden'); // Hide content while loading
            errorMessage.textContent = ''; // Clear previous errors

            try {
                const weatherData = await fetchWeatherData(city);
                if (weatherData) {
                    displayWeather(weatherData);
                } else {
                    // This case might be hit if fetchWeatherData returns null directly (though it throws)
                    showError('Could not retrieve weather data. Please try again.');
                }
            } catch (error) {
                showError(`Error: ${error.message}. Please check the city name and try again.`);
                console.error('Failed to fetch weather:', error);
            } finally {
                // Hide loading indicator
                loadingIndicator.classList.add('hidden');
            }
        });

        // Allow pressing Enter key to trigger search
        cityInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                getWeatherBtn.click();
            }
        });

        // Optional: Pre-populate with a default city or fetch current location weather
        // window.addEventListener('load', () => {
        //     cityInput.value = 'London'; // Default city
        //     getWeatherBtn.click();
        // });
    </script>
</body>
</html>
